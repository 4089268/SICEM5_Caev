@namespace Sicem_Blazor.SqlManager.Views.Partials
@using Sicem_Blazor.SqlManager.Models


<div class="panel-root">
    <div class="actions-panel">
        <MatButton Class="btn btn-primary" Raised="true" Icon="play_arrow" OnClick="@RunOnClick" Label="Ejecutar Query"></MatButton>
    </div>

    <div class="text-panel">
        <div class="p-1 bg-secondary text-white">Editor:
            @if(Query != null)
            {
                <span class="mx-1">@Query.Name</span>
            }
        </div>
        <InputTextArea @bind-Value="@Query.Query" />
    </div>

    <div class="enlaces-panel">
        <div class="p-1 bg-secondary text-white">Enlaces</div>
        @if(Enlaces != null)
        {
            <div>
                @foreach(var item in Enlaces)
                {
                    <div class="d-flex align-items-center p-1">
                        <input type="checkbox" value="@item.Nombre"/>
                        <label class="ml-1 ms-2">@item.Nombre</label>
                    </div>
                }
            </div>
        }
    </div>

    <div class="output-panel">
        <div class="p-1 bg-secondary text-white">Resultados</div>
        <MatAccordion>
            @foreach (var item in Query.Results)
            {
                <MatExpansionPanel Id="@item.Id.ToString()">
                    <MatExpansionPanelSummary>
                        <MatExpansionPanelHeader>
                            <div class="d-flex">
                                @switch(item.Status)
                                {
                                    case QueryResult.QueryResultStatus.Success:
                                        <i class="fas fa-check-circle text-success mr-2 me-2" style="font-size:1.5rem;"></i>
                                        break;
                                    case QueryResult.QueryResultStatus.Failure:
                                        <i class="fas fa-exclamation-circle text-danger mr-2 me-2" style="font-size:1.5rem;"></i>
                                        break;
                                    default:
                                        <div class="spinner-border p-2 mr-2 me-2" role="status"> </div>
                                        break;
                                }
                                <p>Resultados: @item.Name</p>
                            </div>
                        </MatExpansionPanelHeader>
                    </MatExpansionPanelSummary>
                    <MatExpansionPanelDetails>
                        <p>
                            I'm visible because I am open
                            @item.Result
                        </p>
                    </MatExpansionPanelDetails>
                </MatExpansionPanel>
            }
        </MatAccordion>
    </div>

</div>

<style>
    .panel-root
    {
        display: grid;
        grid-template-rows: 3.5rem 1fr 1fr;
        grid-template-columns: 1fr 32rem;
        grid-template-areas:
            "actions actions"
            "editor enlaces"
            "results results";

        width: 100%;
        height: 100%;
        overflow: auto;
        padding: .5rem;
    }

    .panel-root .text-panel, .panel-root .output-panel, .panel-root .enlaces-panel
    {
        border: 1px solid #bbb;
    }

    .panel-root .actions-panel
    {
        width: 100%;
        height: 100%;
        grid-area: actions;
    }

    .panel-root .text-panel
    {
        width: 100%;
        height: 100%;
        grid-area: editor;
    }

    .panel-root .text-panel textarea
    {
        width: 100%;
        height: 100%;
        resize: none;
        font-size: 1.4rem;
        font-family: monospace;
        border: none;
        
    }

    .panel-root .enlaces-panel
    {
        width: 100%;
        height: 100%;
        grid-area: enlaces;
        border-left: none;
        border-bottom:none;
        overflow-y: auto;
    }

    .panel-root .output-panel
    {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: scroll;
        grid-area: results;
    }

</style>